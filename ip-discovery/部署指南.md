# IPå‘ç°ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## ç¼–è¯‘å®Œæˆï¼

âœ… ç³»ç»Ÿå·²æˆåŠŸç¼–è¯‘ï¼Œç”Ÿæˆäº†ä»¥ä¸‹å¯æ‰§è¡Œæ–‡ä»¶ï¼š
- `ip-discovery` - å½“å‰å¹³å°ç‰ˆæœ¬
- `ip-discovery-linux-amd64` - Linux 64ä½ç‰ˆæœ¬

## å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### 1. ä¸Šä¼ åˆ°æœåŠ¡å™¨
```bash
# å°†Linuxç‰ˆæœ¬ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp ip-discovery-linux-amd64 user@your-server:/opt/ip-discovery/
scp config.yaml user@your-server:/opt/ip-discovery/

# åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®æƒé™
ssh user@your-server
chmod +x /opt/ip-discovery/ip-discovery-linux-amd64
cd /opt/ip-discovery
ln -s ip-discovery-linux-amd64 ip-discovery
```

### 2. é…ç½®InfluxDB
æ ¹æ®ä¹‹å‰çš„æŒ‡å—é…ç½®InfluxDBï¼Œç„¶åæ›´æ–° `config.yaml`ï¼š

```yaml
influxdb:
  url: "http://localhost:8086"  # æˆ–ä½ çš„InfluxDBåœ°å€
  token: "your-influxdb-token"
  organization: "taiwan-ip-scan"
  segments_bucket: "taiwan_ip_segments"
  alive_bucket: "taiwan_ip_alive"
```

### 3. æµ‹è¯•ç³»ç»Ÿ
```bash
# æµ‹è¯•æ‰€æœ‰ç»„ä»¶
./ip-discovery test

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# === æµ‹è¯•InfluxDBè¿æ¥ ===
# âœ… InfluxDBè¿æ¥æˆåŠŸ
# === æµ‹è¯•APNICæ•°æ®è·å– ===
# ğŸ“ ç¼“å­˜æ–‡ä»¶ä¸å­˜åœ¨
# === æµ‹è¯•pingåŠŸèƒ½ ===
# âœ… 8.8.8.8 (å“åº”æ—¶é—´: 15ms)
```

### 4. è¿è¡Œç³»ç»Ÿ

#### è·å–APNICæ•°æ®
```bash
./ip-discovery fetch
```

#### æµ‹è¯•æ‰«æ
```bash
# æµ‹è¯•æ‰«æå•ä¸ªCæ®µ
./ip-discovery scan --cidr "8.8.8.0/24"
```

#### æŸ¥çœ‹ç»Ÿè®¡
```bash
./ip-discovery stats
```

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. åˆ›å»ºç³»ç»ŸæœåŠ¡
åˆ›å»º `/etc/systemd/system/ip-discovery.service`ï¼š

```ini
[Unit]
Description=IP Discovery System
After=network.target influxdb.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/ip-discovery
ExecStart=/opt/ip-discovery/ip-discovery scan
Restart=always
RestartSec=30

[Install]
WantedBy=multi-user.target
```

### 2. å¯ç”¨æœåŠ¡
```bash
sudo systemctl daemon-reload
sudo systemctl enable ip-discovery
sudo systemctl start ip-discovery
```

### 3. å®šæ—¶ä»»åŠ¡
æ·»åŠ åˆ° crontabï¼š

```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹è·å–æœ€æ–°APNICæ•°æ®
0 2 * * * /opt/ip-discovery/ip-discovery fetch

# æ¯å°æ—¶æ‰«æä¸€æ¬¡
0 * * * * /opt/ip-discovery/ip-discovery scan --max 100
```

## ç›‘æ§å’Œç»´æŠ¤

### 1. æŸ¥çœ‹æ—¥å¿—
```bash
# ç³»ç»ŸæœåŠ¡æ—¥å¿—
sudo journalctl -u ip-discovery -f

# åº”ç”¨æ—¥å¿—ï¼ˆå¦‚æœé…ç½®äº†æ—¥å¿—æ–‡ä»¶ï¼‰
tail -f /opt/ip-discovery/logs/scanner.log
```

### 2. æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
htop
iostat -x 1

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -an | grep :8086
```

### 3. æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½InfluxDBæ•°æ®
influx backup /backup/influxdb-$(date +%Y%m%d) --org taiwan-ip-scan
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **InfluxDBè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥InfluxDBçŠ¶æ€
   sudo systemctl status influxdb
   
   # æ£€æŸ¥ç«¯å£
   sudo netstat -tlnp | grep 8086
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # ç»™ç¨‹åºç½‘ç»œæƒé™ï¼ˆLinuxï¼‰
   sudo setcap cap_net_raw+ep ./ip-discovery
   ```

3. **å†…å­˜ä¸è¶³**
   ```bash
   # è°ƒæ•´æ‰«æå‚æ•°
   # åœ¨config.yamlä¸­å‡å°‘workersæ•°é‡
   scanner:
     workers: 50  # ä»100å‡å°‘åˆ°50
   ```

### æ€§èƒ½ä¼˜åŒ–

1. **è°ƒæ•´å¹¶å‘æ•°**
   - æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´ `workers` æ•°é‡
   - ç½‘ç»œå¸¦å®½å……è¶³æ—¶å¯ä»¥å¢åŠ åˆ°200-500

2. **è°ƒæ•´è¶…æ—¶æ—¶é—´**
   - ç½‘ç»œè¾ƒæ…¢æ—¶å¢åŠ  `ping_timeout`
   - å¿«é€Ÿæ‰«ææ—¶å‡å°‘åˆ°500ms

3. **åˆ†æ‰¹å¤„ç†**
   - ä½¿ç”¨ `--max` å‚æ•°é™åˆ¶æ¯æ¬¡æ‰«æçš„æ®µæ•°
   - é¿å…ä¸€æ¬¡æ€§å¤„ç†è¿‡å¤šæ•°æ®

## æ‰©å±•åŠŸèƒ½

### 1. æ·»åŠ Webç•Œé¢
å¯ä»¥é›†æˆGrafanaæ˜¾ç¤ºæ‰«æç»“æœï¼š

```bash
# å®‰è£…Grafana
sudo apt install grafana

# é…ç½®InfluxDBæ•°æ®æº
# åˆ›å»ºä»ªè¡¨æ¿æ˜¾ç¤ºå­˜æ´»IPè¶‹åŠ¿
```

### 2. é›†ç¾¤éƒ¨ç½²
å¤šå°æœåŠ¡å™¨ååŒæ‰«æï¼š

```bash
# æœåŠ¡å™¨Aæ‰«æå‰åŠéƒ¨åˆ†IPæ®µ
./ip-discovery scan --max 1000

# æœåŠ¡å™¨Bæ‰«æååŠéƒ¨åˆ†IPæ®µ  
./ip-discovery scan --max 1000 --offset 1000
```

### 3. ç»“æœå¯¼å‡º
```bash
# å¯¼å‡ºæ‰«æç»“æœåˆ°CSV
./ip-discovery export --format csv --output results.csv
```

## å®‰å…¨å»ºè®®

1. **ç½‘ç»œå®‰å…¨**
   - é™åˆ¶InfluxDBè®¿é—®IP
   - ä½¿ç”¨é˜²ç«å¢™è§„åˆ™
   - å¯ç”¨HTTPS

2. **æ‰«æé¢‘ç‡**
   - é¿å…è¿‡äºé¢‘ç¹çš„æ‰«æ
   - éµå®ˆç›®æ ‡ç½‘ç»œçš„ä½¿ç”¨æ”¿ç­–
   - è®¾ç½®åˆç†çš„æ‰«æé—´éš”

3. **æ•°æ®ä¿æŠ¤**
   - å®šæœŸå¤‡ä»½InfluxDBæ•°æ®
   - è®¾ç½®æ•°æ®ä¿ç•™ç­–ç•¥
   - åŠ å¯†æ•æ„Ÿé…ç½®ä¿¡æ¯

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
2. InfluxDBæ˜¯å¦æ­£å¸¸è¿è¡Œ
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. ç³»ç»Ÿèµ„æºæ˜¯å¦å……è¶³

ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼