# 网吧点餐系统设计文档

## 1. 系统概述

### 1.1 项目背景
本系统是为网吧设计的一套点餐系统，旨在方便网吧顾客在线点餐、支付，同时帮助网吧管理人员高效管理订单、商品和库存。

### 1.2 系统定位
- 独立运行的网吧点餐系统
- 支持顾客自主点餐和前台人工点餐
- 提供商品管理、订单管理、用户管理等核心功能
- 基于Web技术实现，支持多终端访问

### 1.3 设计目标
- 易用性：界面简洁直观，操作流程简单
- 可靠性：系统稳定运行，数据安全可靠
- 高效性：订单处理快速，响应及时
- 可扩展性：支持功能扩展和定制化需求

## 2. 功能需求

### 2.1 核心功能

| 功能模块 | 顾客端 | 管理员端 |
|---------|-------|---------|
| 商品浏览 | ✅ | ❌ |
| 购物车管理 | ✅ | ❌ |
| 订单提交 | ✅ | ❌ |
| 订单支付 | ✅ | ❌ |
| 订单查询 | ✅ | ✅ |
| 商品管理 | ❌ | ✅ |
| 库存管理 | ❌ | ✅ |
| 订单管理 | ❌ | ✅ |
| 用户管理 | ❌ | ✅ |
| 报表统计 | ❌ | ✅ |

### 2.2 详细功能描述

#### 2.2.1 商品管理
- 商品分类管理（添加、编辑、删除分类）
- 商品信息管理（添加、编辑、删除商品）
- 商品图片上传
- 商品价格管理
- 商品库存管理

#### 2.2.2 订单管理
- 订单创建（顾客自主创建/管理员创建）
- 订单状态管理（待支付、已支付、制作中、已完成、已取消）
- 订单查询（按时间、状态、顾客等条件）
- 订单详情查看
- 订单打印

#### 2.2.3 用户管理
- 管理员账号管理
- 顾客信息管理
- 权限管理

#### 2.2.4 支付管理
- 支持多种支付方式（现金、扫码支付等）
- 支付状态同步
- 支付记录查询

#### 2.2.5 报表统计
- 销售报表（日/周/月/年）
- 商品销售排行
- 营业数据分析

## 3. 非功能需求

### 3.1 性能需求
- 页面响应时间：≤2秒
- 并发用户数：支持500并发
- 订单处理速度：≤1秒/单

### 3.2 安全需求
- 数据加密存储
- 权限控制严格
- 防止SQL注入
- 防止XSS攻击
- 日志记录完整

### 3.3 可用性需求
- 系统可用性：≥99.5%
- 数据备份机制
- 故障恢复时间：≤30分钟

### 3.4 兼容性需求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端访问

## 4. 系统架构

### 4.1 技术栈

| 分类 | 技术 | 版本 |
|-----|-----|-----|
| 后端框架 | Flask | 2.0+ |
| 前端框架 | Bootstrap | 5.0+ |
| 数据库 | SQLite | 3.0+ |
| 开发语言 | Python | 3.8+ |
| 模板引擎 | Jinja2 | 3.0+ |
| CSS框架 | Bootstrap | 5.0+ |
| JavaScript | jQuery | 3.6+ |

### 4.2 架构设计

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   顾客浏览器    │────▶│    前端服务器   │────▶│    后端服务器   │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                              ▲                        │
                              │                        ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   管理员浏览器  │────▶│    管理后台     │     │    数据库       │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 4.3 系统分层

1. **表示层**：负责用户界面展示和用户交互
2. **业务逻辑层**：处理核心业务逻辑
3. **数据访问层**：负责数据库操作
4. **数据存储层**：存储系统数据

## 5. 数据库设计

### 5.1 实体关系图

```
┌────────────┐       ┌────────────┐       ┌────────────┐
│   商品分类  │───1:N─│    商品    │───N:1─│    订单明细 │
└────────────┘       └────────────┘       └────────────┘
                                              │
                                              │ N:1
                                              ▼
                                        ┌────────────┐
                                        │    订单    │
                                        └────────────┘
                                              │
                                              │ N:1
                                              ▼
                                        ┌────────────┐
                                        │    用户    │
                                        └────────────┘
```

### 5.2 核心表结构

#### 5.2.1 商品分类表（categories）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 分类ID |
| name | VARCHAR(50) | NOT NULL UNIQUE | 分类名称 |
| description | TEXT | | 分类描述 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 5.2.2 商品表（products）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 商品ID |
| category_id | INTEGER | NOT NULL REFERENCES categories(id) | 分类ID |
| name | VARCHAR(100) | NOT NULL UNIQUE | 商品名称 |
| description | TEXT | | 商品描述 |
| price | DECIMAL(10,2) | NOT NULL | 商品价格 |
| stock | INTEGER | NOT NULL DEFAULT 0 | 库存数量 |
| image | VARCHAR(255) | | 商品图片路径 |
| is_available | BOOLEAN | NOT NULL DEFAULT 1 | 是否可售 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 5.2.3 用户表（users）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 用户ID |
| username | VARCHAR(50) | NOT NULL UNIQUE | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码（加密存储） |
| role | VARCHAR(20) | NOT NULL DEFAULT 'customer' | 角色（customer/admin） |
| nickname | VARCHAR(50) | | 用户昵称 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 5.2.4 订单表（orders）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 订单ID |
| user_id | INTEGER | NOT NULL REFERENCES users(id) | 用户ID |
| total_amount | DECIMAL(10,2) | NOT NULL | 订单总金额 |
| status | VARCHAR(20) | NOT NULL DEFAULT 'pending' | 订单状态 |
| payment_method | VARCHAR(20) | | 支付方式 |
| payment_status | VARCHAR(20) | NOT NULL DEFAULT 'unpaid' | 支付状态 |
| table_number | VARCHAR(20) | | 桌号/机器号 |
| notes | TEXT | | 备注信息 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 5.2.5 订单明细表（order_items）
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 明细ID |
| order_id | INTEGER | NOT NULL REFERENCES orders(id) | 订单ID |
| product_id | INTEGER | NOT NULL REFERENCES products(id) | 商品ID |
| quantity | INTEGER | NOT NULL | 商品数量 |
| unit_price | DECIMAL(10,2) | NOT NULL | 商品单价 |
| total_price | DECIMAL(10,2) | NOT NULL | 商品总价 |

## 6. 系统架构设计

### 6.1 目录结构

```
ordorsystem/
├── backend/               # 后端代码
│   ├── app.py             # 应用入口
│   ├── config.py          # 配置文件
│   ├── models/            # 数据模型
│   ├── routes/            # 路由定义
│   ├── services/          # 业务逻辑
│   ├── utils/             # 工具函数
│   └── requirements.txt   # 依赖列表
├── frontend/              # 前端代码
│   ├── static/            # 静态资源
│   │   ├── css/           # CSS文件
│   │   ├── js/            # JavaScript文件
│   │   └── images/        # 图片资源
│   └── templates/         # HTML模板
│       ├── customer/      # 顾客端模板
│       └── admin/         # 管理员端模板
├── database/              # 数据库文件
│   └── ordersystem.db     # SQLite数据库
├── config/                # 配置文件
├── 需求文档.md            # 需求文档
├── 系统设计文档.md        # 本文件
└── 测试文档.md            # 测试文档
```

### 6.2 关键技术点

1. **后端框架**：Flask
2. **数据库**：SQLite（开发环境）/ MySQL（生产环境）
3. **ORM**：SQLAlchemy
4. **模板引擎**：Jinja2
5. **前端框架**：Bootstrap 5
6. **前端交互**：jQuery
7. **身份验证**：Session + 密码哈希
8. **支付集成**：预留支付接口

## 7. 接口设计

### 7.1 API接口规范

| 接口类型 | URL前缀 | 认证方式 |
|---------|---------|---------|
| 顾客端API | /api/customer/ | Session认证 |
| 管理员API | /api/admin/ | Session认证 |

### 7.2 核心API接口

#### 7.2.1 商品相关接口
- `GET /api/customer/products` - 获取商品列表
- `GET /api/customer/products/<id>` - 获取商品详情
- `GET /api/customer/categories` - 获取分类列表

#### 7.2.2 订单相关接口
- `POST /api/customer/orders` - 创建订单
- `GET /api/customer/orders` - 获取顾客订单列表
- `GET /api/customer/orders/<id>` - 获取订单详情
- `PUT /api/customer/orders/<id>/cancel` - 取消订单
- `GET /api/admin/orders` - 获取所有订单
- `PUT /api/admin/orders/<id>/status` - 更新订单状态

#### 7.2.3 用户相关接口
- `POST /api/customer/register` - 顾客注册
- `POST /api/customer/login` - 顾客登录
- `POST /api/admin/login` - 管理员登录
- `GET /api/customer/profile` - 获取顾客个人信息

## 8. 部署方案

### 8.1 开发环境部署
1. 安装Python 3.8+
2. 安装依赖：`pip install -r backend/requirements.txt`
3. 初始化数据库：`python backend/init_db.py`
4. 启动开发服务器：`python backend/app.py`
5. 访问地址：http://localhost:5000

### 8.2 生产环境部署
1. 安装Python 3.8+和Nginx
2. 安装依赖：`pip install -r backend/requirements.txt`
3. 配置Nginx反向代理
4. 使用Gunicorn作为WSGI服务器
5. 配置Supervisor管理进程
6. 设置定期备份数据库

## 9. 安全设计

### 9.1 数据安全
- 密码使用bcrypt加密存储
- 敏感数据传输使用HTTPS
- 数据库连接使用参数化查询防止SQL注入

### 9.2 访问控制
- 基于角色的访问控制（RBAC）
- 管理员账号严格管理
- 会话超时机制

### 9.3 防御措施
- 防止XSS攻击（输入验证、输出转义）
- 防止CSRF攻击（CSRF令牌）
- 防止暴力破解（登录次数限制）

## 10. 测试计划

### 10.1 测试类型
- 单元测试：测试各个功能模块
- 集成测试：测试模块间的交互
- 系统测试：测试整个系统的功能
- 性能测试：测试系统的性能指标
- 安全测试：测试系统的安全性

### 10.2 测试重点
- 订单流程测试
- 支付功能测试
- 商品管理测试
- 权限控制测试
- 并发测试

## 11. 维护计划

### 11.1 日常维护
- 系统监控
- 日志分析
- 数据备份

### 11.2 定期维护
- 系统更新
- 安全补丁安装
- 数据库优化

## 12. 扩展性设计

### 12.1 功能扩展
- 支持外卖功能
- 支持会员积分系统
- 支持优惠券功能
- 支持数据分析功能

### 12.2 技术扩展
- 支持分布式部署
- 支持微服务架构
- 支持大数据分析

## 13. 总结

本设计文档详细描述了网吧点餐系统的功能需求、系统架构、数据库设计、接口设计等方面的内容，为系统开发提供了详细的指导。系统采用前后端分离的架构，基于Python Flask框架开发，具有良好的可扩展性和维护性。系统实现后，将大大提高网吧的点餐效率和管理水平，提升顾客体验。