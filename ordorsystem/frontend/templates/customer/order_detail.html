{% extends "base.html" %}

{% block title %}订单详情 - 网吧点餐系统{% endblock %}

{% block navigation %}
    {% include 'customer/navigation.html' %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('customer.home') }}">首页</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('customer.orders') }}">我的订单</a></li>
            <li class="breadcrumb-item active" aria-current="page">订单详情</li>
        </ol>
    </nav>
    
    <!-- Order Header -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="card-title mb-3">订单信息</h5>
                    <div class="row mb-2">
                        <div class="col-4">订单号：</div>
                        <div class="col-8">{{ order.order_no }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4">下单时间：</div>
                        <div class="col-8">{{ order.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4">桌号/机器号：</div>
                        <div class="col-8">{{ order.table_number or '未填写' }}</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5 class="card-title mb-3">订单状态</h5>
                    <div class="row mb-2">
                        <div class="col-4">订单状态：</div>
                        <div class="col-8">
                            {% if order.status == 'pending' %}
                                <span class="badge bg-warning">待支付</span>
                            {% elif order.status == 'paid' %}
                                <span class="badge bg-info">已支付</span>
                            {% elif order.status == 'preparing' %}
                                <span class="badge bg-primary">制作中</span>
                            {% elif order.status == 'completed' %}
                                <span class="badge bg-success">已完成</span>
                            {% elif order.status == 'cancelled' %}
                                <span class="badge bg-danger">已取消</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4">支付方式：</div>
                        <div class="col-8">{{ order.payment_method or '未选择' }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-4">支付状态：</div>
                        <div class="col-8">
                            {% if order.payment_status == 'paid' %}
                                <span class="badge bg-success">已支付</span>
                            {% else %}
                                <span class="badge bg-danger">未支付</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notes -->
            {% if order.notes %}
                <div class="row mt-3">
                    <div class="col">
                        <h6>备注：</h6>
                        <p class="text-muted">{{ order.notes }}</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Order Items -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">商品明细</h5>
        </div>
        <div class="card-body">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th scope="col">商品名称</th>
                        <th scope="col" class="text-center">数量</th>
                        <th scope="col" class="text-end">单价</th>
                        <th scope="col" class="text-end">小计</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.order_items %}
                        <tr>
                            <td>{{ item.product_name }}</td>
                            <td class="text-center">{{ item.quantity }}</td>
                            <td class="text-end">¥{{ item.unit_price }}</td>
                            <td class="text-end">¥{{ item.total_price }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row" colspan="3" class="text-end">总计：</th>
                        <th scope="row" class="text-end text-primary fw-bold">¥{{ order.total_amount }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    
    <!-- Order Actions -->
    <div class="row">
        <div class="col text-center">
            <a href="{{ url_for('customer.orders') }}" class="btn btn-primary">
                <i class="fa fa-arrow-left me-2"></i> 返回订单列表
            </a>
            {% if order.status == 'pending' %}
                <a href="#" class="btn btn-success ms-2">
                    <i class="fa fa-credit-card me-2"></i> 立即支付
                </a>
            {% endif %}
            {% if order.can_cancel() %}
                <a href="#" class="btn btn-danger ms-2">
                    <i class="fa fa-times me-2"></i> 取消订单
                </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}