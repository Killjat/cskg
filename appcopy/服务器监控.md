# 服务器监控系统需求文档

## 1. 项目概述

### 1.1 目的
本需求文档旨在定义服务器监控系统的功能需求、非功能需求和数据需求，确保系统能够满足对服务器进行全面监控的要求，包括用户登录、文件操作、进程和命令执行等方面的实时监控和记录。

### 1.2 范围
本系统主要用于监控Linux服务器的关键活动，包括：
- 当前登录账号信息
- 文件系统操作（创建、读取、写入、删除、复制、移动）
- 进程状态和命令执行情况
- 当前正在执行的命令

### 1.3 术语定义
| 术语 | 定义 |
|------|------|
| 登录账号 | 通过本地终端或远程连接（如SSH）登录到服务器的用户账号 |
| 文件操作 | 对文件系统中文件或目录的创建、读取、写入、删除、复制、移动等操作 |
| 进程 | 服务器上正在运行的程序实例，每个进程有唯一的进程ID（PID） |
| 命令 | 用户或系统执行的可执行程序或脚本 |

## 2. 功能需求

### 2.1 当前登录账号监控
- **2.1.1** 实时监控并显示当前登录到服务器的所有用户账号
- **2.1.2** 记录每个登录账号的详细信息：
  - 用户名
  - 登录时间
  - 登录类型（本地终端、SSH远程等）
  - 来源IP地址（如为远程登录）
  - 登录终端
  - 登录时长
- **2.1.3** 支持按用户名、登录时间、来源IP等条件查询登录记录
- **2.1.4** 当有新用户登录或用户登出时，生成相应的事件通知

### 2.2 文件操作监控
- **2.2.1** 监控并记录服务器上的所有文件操作，包括：
  - 创建文件/目录
  - 读取文件/目录
  - 写入文件
  - 删除文件/目录
  - 复制文件/目录
  - 移动文件/目录
- **2.2.2** 记录每个文件操作的详细信息：
  - 操作类型
  - 涉及的文件/目录路径
  - 操作时间
  - 执行操作的用户
  - 执行操作的进程ID和名称
  - 操作结果（成功/失败）
- **2.2.3** 支持按文件路径、操作类型、用户、时间等条件查询文件操作记录
- **2.2.4** 对敏感文件（如配置文件、系统文件）的操作进行重点监控和告警

### 2.3 进程与命令监控
- **2.3.1** 实时统计服务器上的进程总数
- **2.3.2** 记录每个进程的详细信息：
  - 进程ID（PID）
  - 父进程ID（PPID）
  - 进程名称
  - 命令行参数
  - 启动时间
  - 执行用户
  - CPU使用率
  - 内存使用率
  - 状态（运行中、休眠、僵尸等）
- **2.3.3** 记录每个进程执行的命令历史
- **2.3.4** 支持按进程ID、名称、用户、状态等条件查询进程信息
- **2.3.5** 当进程数量异常增长或出现可疑进程时，生成告警

### 2.4 当前执行命令监控
- **2.4.1** 实时监控并显示服务器上当前正在执行的所有命令
- **2.4.2** 记录每个当前执行命令的详细信息：
  - 命令字符串
  - 进程ID（PID）
  - 父进程ID（PPID）
  - 执行用户
  - 启动时间
  - 执行时长
  - CPU使用率
  - 内存使用率
- **2.4.3** 支持按命令名称、用户、执行时长等条件查询当前执行的命令
- **2.4.4** 对长时间运行的命令或消耗大量资源的命令进行重点监控和告警

## 3. 非功能需求

### 3.1 性能要求
- **3.1.1** 监控系统自身CPU使用率不超过5%
- **3.1.2** 监控系统自身内存占用不超过100MB
- **3.1.3** 监控数据采集延迟不超过1秒
- **3.1.4** 支持同时监控至少1000个进程

### 3.2 可靠性要求
- **3.2.1** 监控系统可用性达到99.9%
- **3.2.2** 系统故障时不影响被监控服务器的正常运行
- **3.2.3** 监控数据应定期备份，防止数据丢失

### 3.3 安全性要求
- **3.3.1** 监控数据传输应采用加密方式，防止数据泄露
- **3.3.2** 监控系统应具备访问控制机制，仅授权用户可访问
- **3.3.3** 监控日志应受到保护，防止未授权修改或删除

### 3.4 可扩展性要求
- **3.4.1** 系统架构应支持模块化扩展，便于添加新的监控功能
- **3.4.2** 支持监控多台服务器，具备分布式监控能力
- **3.4.3** 支持与其他系统（如告警系统、日志分析系统）集成

## 4. 数据需求

### 4.1 数据类型
- 登录数据：用户名、登录时间、来源IP、终端类型等
- 文件操作数据：操作类型、文件路径、操作时间、执行用户等
- 进程数据：PID、PPID、进程名称、命令行、资源使用情况等
- 命令数据：命令字符串、PID、执行用户、执行时长等

### 4.2 数据存储
- 监控数据应持久化存储，保留期限可配置（默认30天）
- 支持多种存储方式：
  - 关系型数据库（如MySQL、PostgreSQL）
  - 时序数据库（如InfluxDB、Prometheus）
  - 日志文件（如JSON格式）

## 5. 环境要求

### 5.1 硬件要求
- CPU：至少2核
- 内存：至少4GB
- 磁盘：至少10GB可用空间

### 5.2 软件要求
- 操作系统：Linux（CentOS 7+、Ubuntu 18.04+等）
- 开发语言：Go 1.21+
- 依赖库：根据具体实现选择（如gopacket、inotify等）

## 6. 测试要求

### 6.1 功能测试
- 验证所有功能需求是否实现
- 测试各种场景下的监控效果

### 6.2 性能测试
- 测试监控系统在高负载下的性能表现
- 测试监控数据采集延迟

### 6.3 可靠性测试
- 测试监控系统的稳定性和可用性
- 测试系统故障恢复能力

### 6.4 安全性测试
- 测试数据传输的安全性
- 测试访问控制机制的有效性

## 7. 验收标准

### 7.1 功能验收
- 所有功能需求均已实现并通过测试
- 监控数据准确、完整
- 系统操作界面友好、易用

### 7.2 性能验收
- 监控系统自身资源占用符合要求
- 监控数据采集延迟符合要求

### 7.3 可靠性验收
- 系统连续运行72小时无故障
- 数据备份和恢复功能正常

### 7.4 安全性验收
- 数据传输加密机制有效
- 访问控制机制有效
- 日志保护机制有效

## 8. 附录

### 8.1 参考文档
- Linux系统管理相关文档
- 监控系统设计最佳实践

### 8.2 术语表
- 终端：用户与计算机系统交互的界面
- 进程：正在执行的程序实例
- PID：进程标识符
- PPID：父进程标识符
- SSH：Secure Shell，用于远程登录的网络协议
- inotify：Linux内核提供的文件系统事件监控机制
- eBPF：Extended Berkeley Packet Filter，用于内核级监控的技术